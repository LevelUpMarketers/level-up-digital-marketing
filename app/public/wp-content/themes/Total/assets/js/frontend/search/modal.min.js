!function(e){const t=document.querySelector("#wpex-search-modal");if(!t)return;const s=t.querySelector(".wpex-search-modal__form"),a=t.querySelector(".wpex-search-modal__input"),r=t.querySelector(".wpex-search-modal__clear"),l=t.querySelector(".wpex-search-modal__results"),n=t.querySelector(".wpex-search-modal__loading"),i=t.querySelector(".wpex-search-modal__search-icon"),c=t.querySelector(".wpex-search-modal__no-results");let o;const d=()=>{o="",l.classList.add("wpex-hidden"),n.classList.add("wpex-invisible"),i.classList.remove("wpex-invisible"),c.classList.add("wpex-hidden"),a.value||(r.classList.add("wpex-invisible","wpex-opacity-0"),r.disabled=!0),l.innerHTML=""},p=()=>a.value&&(a.value.match(/[a-zA-Z0-9]/g)||[]).length>=e.character_threshold,h=((e,t)=>{let s;return a=>{clearTimeout(s),s=setTimeout((()=>e(a)),t)}})((s=>{if(o=a.value,!o||!t.hasAttribute("open"))return;const r=(s.ctrlKey||s.metaKey)&&"a"===s.key;isSearchAllowed=!r&&!["Meta","MetaLeft","MetaRight","Control","Shift","Alt","CapsLock","Tab"].includes(s.key)&&p(),isSearchAllowed&&(n.classList.remove("wpex-invisible"),i.classList.add("wpex-invisible"),fetch(e.ajax_url,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"wpex_ajax_search",search_string:o,nonce:e.nonce})}).then((e=>e.json())).then((t=>{p()?(l.innerHTML="",l.scrollTop=0,n.classList.add("wpex-invisible"),i.classList.remove("wpex-invisible"),t.length?(c.classList.add("wpex-hidden"),l.classList.remove("wpex-hidden"),(t=>{const s=document.getElementById("wpex-search-modal-result-template");if(t.forEach((e=>{e=((e,t)=>{for(const s in t)e=e.replace(`{{${s}}}`,t.hasOwnProperty(s)?t[s]:"");return e})(s.innerHTML,e),l.innerHTML+=e})),e.highlight&&0!==parseInt(e.highlight)){const e=new RegExp(`(${o})`,"gi");l.innerHTML=l.innerHTML.replace(/(^|>)([^<]+)(?=<|$)/g,((t,s,a)=>s+a.replace(e,(e=>`<span class="wpex-modal-search__result-highlight wpex-text-accent">${e}</span>`))))}})(t)):(c.classList.remove("wpex-hidden"),l.classList.add("wpex-hidden"))):d()})).catch((e=>{l.innerHTML=e,console.error("Error:",e)})))}),e.throttle_delay||500);a.addEventListener("input",(()=>{t.hasAttribute("open")&&(a.value&&(r.classList.remove("wpex-invisible","wpex-opacity-0"),r.disabled=!1),p()||d())})),a.addEventListener("input",h),r.addEventListener("click",(()=>{a.value="",d(),a.focus({preventScroll:!1})})),s.addEventListener("submit",(e=>{e.preventDefault()})),l.addEventListener("keydown",(e=>{"Escape"===e.key&&e.target.closest(".wpex-search-modal-result")&&(e.preventDefault(),a.focus({preventScroll:!1}))}))}(wpex_search_modal_params);